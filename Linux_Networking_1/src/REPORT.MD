# Отчёт по проекту "Linux Networking 1".

## Содержание
1. [Инструмент ipcalc](#part-1-инструмент-ipcalc)
2. [Статическая маршрутизация между двумя машинами](#part-2-статическая-маршрутизация-между-двумя-машинами)
3. [Утилита iperf3](#part-3-утилита-iperf3)
4. [Сетевой экран](#part-4-сетевой-экран)
5. [Статическая маршрутизация сети](#part-5-статическая-маршрутизация-сети)
6. [Динамическая настройка IP с помощью DHCP](#part-6-динамическая-настройка-IP-с-помощью-DHCP)
7.[NAT](#part-7-nat)
## Part 1. Инструмент **ipcalc**

### 1.1 Сети и Маски

- Адрес сети 192.167.38.54/13 - `192.160.0.0`

- Перевод маски 255.255.255.0 в префиксную запись - `/24`

- Перевод маски 255.255.255.0 в двоичную запись - `11111111.11111111.11111111.00000000`

- Перевод маски 11111111.11111111.11111111.11110000 в обычную - `255.255.255.240`

- Минимальный хост в сети 12.167.38.4 при маске \8 - `12.0.0.1`, максимальный - `12.255.255.254`

- Минимальный хост в сети 12.167.38.4 при маске 11111111.11111111.00000000.00000000 - `12.167.0.1`, максимальный - `12.167.255.254`

- Минимальный хост в сети 12.167.38.4 при маске 255.255.254.0 - `12.167.38.0.1`, максимальный - `12.167.39.255`

- Минимальный хост в сети 12.167.38.4 при маске /4 - `0.0.0.1`, максимальный - `15.255.255.254`

### 1.2 localhost

Задание - Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1

Localhost работает на маске подсети 255.0.0.0
![](./screenshots/1.png)

Значит, он может напрямую связаться с адресами `127.0.0.1` - `127.255.255.254` а значит, он сможет связаться с  `127.0.0.2`, `127.1.0.1`

### 1.3. Диапазоны и сегменты сетей

Определить и записать в отчёт:
1)  какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1

Чтобы как-то отличать белую и серую адресацию, во всем мире было принято решение выделить из общего диапазона адресов четыре подсети:

10.0.0.0 – 10.255.255.255 с маской 255.0.0.0;
172.16.0.0 – 172.31.255.255 с маской 255.240.0.0;
192.168.0.0 – 192.168.255.255 с маской 255.255.0.0

Получаем, что частные айпи адреса:
 `192.168.4.2, 172.20.250.4, 10.0.0.45, 10.10.10.10`

А публичные :
 `134.43.0.2, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 192.169.168.1`

2) какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255

Адресом шлюза может быть любой ip адрес кроме адреса сети и широковещательного, т.е входит в интервал `10.10.0.1` - `10.10.63.254`

Ответ: `10.10.0.2, 10.10.10.10, 10.10.1.255`

## Part 2. Статическая маршрутизация между двумя машинами

- Команда `ip a` на обеих виртуалках

![](./screenshots/2.png)

- Изменил файлы /etc/netplan/00-installer-config.yaml  на обеих машинах:

![](./screenshots/3.png)

- netplan apply на обеих машинах

![](./screenshots/4.png)

- добавил маршруты

![](./screenshots/5.png)

- пропинговал одну машину с другой и наоборот

![](./screenshots/6.png)

- перезагрузил систему

- прописал пути в конфиге и снова перезагрузил систему

![](./screenshots/7.png)

- пропинговал машины

![](./screenshots/8.png)

## Part 3. Утилита **iperf3**

### Перевести и записать в отчёт: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps

- 8 Mbps = 1 MB/s

- 100 MB/s = 819200 Kbs

- 1 Gbps = 1000 Mbps

### Измерить скорость соединения между ws1 и ws2

- Скачал iperf3
![](./screenshots/9.png)

- Измерил скорость между двумя машинами

ws1 выполняла роль сервера (формат мегабайты)
```
iperf3 -s -f M
```

ws2 выполняла роль клиента (формат мегабайты)
```
iperf3 -c 192.168.100.10
```

![](./screenshots/10.png)

Было передано 4 гигабайта со скоростью 413 мегабайта в секунд

## Part 4. Сетевой экран

#### 4.1. Утилита **iptables**

- добавил правила  `/etc/firewall.sh`

![](./screenshots/11.png)

- поменял доступ и запустил

![](./screenshots/12.png)

- из-за того что правило выбросить пакет стоит у ws1 первым, то оно выполнится первым, когда ws2 будет пинговать ws1, и ws1 не даст ответа, а ws2 наоборот будет пинговаться.

#### 4.2. Утилита **nmap**

- видим что ws1 не пингуется

![](./screenshots/13.png)

- при этом из nmap видим что ws1 запущено

![](./screenshots/14.png)

## Part 5. Статическая маршрутизация сети

#### 5.1. Настройка адресов машин

- настроил маршруты на всех машинах (тут пока айпишники, маршруты не совсем верные)

![](./screenshots/15.png)

- `ip -4 a` на всех машинах

![](./screenshots/16.png)

- пропинговал с ws22 на ws21

![](./screenshots/17.png)

- также пропинговал с r1 на ws11

![](./screenshots/18.png)

#### 5.2. Включение переадресации IP-адресов.

- включил переадресацию во время сеанса на роутерах

![](./screenshots/19.png)

- включил статическую переадресацию

![](./screenshots/20.png)

#### 5.3. Установка маршрута по-умолчанию

- поставил default на всех машинах

![](./screenshots/21.png)

- `ip r` на всех машинах

![](./screenshots/22.png)

- пингую с ws11 на r2, на r2 выполнена команда `tcpdump -tn enp0s8`

![](./screenshots/23.png)

#### 5.4. Добавление статических маршрутов

- добавил маршруты в r1 и r2 

![](./screenshots/24.png)

-  `ip r` на обеих машинах

![](./screenshots/25.png)

- запуск команды `ip r list`

![](./screenshots/26.png)

для сети 10.10.0.0/18 выбран маршрут непосредственно через интерфейс машины ws1 и он определён так как сам интерфейс имеет айпишник, принадлежащий этой сети, путь уже был автоматически определён операционкой, если речь идёт об отправлении пакетов в рамках одной подсети, шлюз не нужен.

#### 5.5. Построение списка маршрутизаторов

- `tracerote` на ws11 до ws21 , tcpdump на r1,

![](./screenshots/27.png)

#### 5.6. Использование протокола **ICMP** при маршрутизации

Пингуем несуществующий ip адресс. Видим что tcmp на r1 показывает "unreachable" при попытке направить трафик с r1.

![](./screenshots/28.png)

## Part 6. Динамическая настройка IP с помощью **DHCP**

- настроил dhcp сервер на r2

![](./screenshots/29.png)

- настроил dns

![](./screenshots/30.png)

- запустил ws21, видим что ему выдался динамическйи ip

![](./screenshots/31.png)

- пингую с ws22 а ws21

![](./screenshots/32.png)

- поставил mac адрес для ws11

![](./screenshots/33.png)

- настроил dhcp сервер на r1

![](./screenshots/34.png)

- в том числе dns

![](./screenshots/35.png)

- обновил dhcp сервер и запустил ws11, видим что ip выдался по мак адресу

![](./screenshots/36.png)

- сначала снял аренду ip, потом обратно попросил dhcp сервер выдать его (айпишник одинаковый так как выдало первый свободный)

![](./screenshots/37.png)

## Part 7. **NAT**

- изменил строку в ports.conf

![](./screenshots/38.png)

- запустил вебсерара на ws22 и r1

![](./screenshots/39.png)

- добавил фаервол

![](./screenshots/40.png)

- пингуем с r1 ws22, видим что не работает

![](./screenshots/41.png)

- добавляем правило на icmp пакеты

![](./screenshots/42.png)

- пингуем снова, как видим работает

![](./screenshots/43.png)

- создал фаервол на r2 

![](./screenshots/44.png)

- успешно подключился к r1 с ws22 по порту 80

![](./screenshots/45.png)

- успешно подключился к ws22 с r1 по порту 8080 (фаервол перенаправит)

![](./screenshots/46.png)

